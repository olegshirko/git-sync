# Git Sync Service

Этот сервис предназначен для двусторонней синхронизации Git-репозиториев. Он позволяет поддерживать актуальное состояние кода между, например, публичным GitLab репозиторием и приватным репозиторием на другом хостинге (GitHub, Bitbucket, Gitea и т.д.).

## Возможности

*   Двусторонняя синхронизация веток между двумя репозиториями.
*   Поддержка аутентификации через Personal Access Token для GitLab.
*   Поддержка аутентификации через SSH-ключи для приватных репозиториев.
*   Гибкая конфигурация для синхронизации нескольких пар репозиториев.
*   Автоматическая очистка временных директорий после синхронизации.

## Конфигурация

Сервис использует файл `configs/config.yaml` для всех настроек. Вам необходимо создать или отредактировать этот файл в соответствии с вашими потребностями.

Пример файла `configs/config.yaml`:

```yaml
# gitlab_token: Ваш Personal Access Token для GitLab.
# Требуется для доступа к репозиториям GitLab.
# Убедитесь, что токен имеет достаточные права (например, read_repository, write_repository).
gitlab_token: "your_gitlab_personal_access_token_here"

# ssh_key_path: Полный путь к вашему приватному SSH-ключу.
# Используется для аутентификации при доступе к приватным репозиториям через SSH.
# Пример: /home/user/.ssh/id_rsa или C:\Users\user\.ssh\id_rsa
# Если вы используете HTTPS для приватных репозиториев, это поле может быть пустым.
ssh_key_path: "/path/to/your/ssh/id_rsa"

# temp_dir: Временная директория, куда будут клонироваться репозитории для синхронизации.
# Убедитесь, что у пользователя, от имени которого запускается сервис, есть права на запись в эту директорию.
temp_dir: "/tmp/git-sync-repos"

# repositories: Список пар репозиториев для синхронизации.
# Вы можете добавить любое количество пар.
repositories:
  - gitlab_url: "https://gitlab.com/your-group/your-gitlab-repo-1.git"
    private_repo_url: "git@github.com:your-org/your-private-repo-1.git" # Или HTTPS: https://github.com/your-org/your-private-repo-1.git
  - gitlab_url: "https://gitlab.com/another-group/your-gitlab-repo-2.git"
    private_repo_url: "git@bitbucket.org:another-org/your-private-repo-2.git"
  # Добавьте другие пары репозиториев по мере необходимости
```

### Описание полей конфигурации:

*   **`gitlab_token`**: Персональный токен доступа GitLab. Используется для аутентификации при работе с репозиториями GitLab.
*   **`ssh_key_path`**: Путь к приватному SSH-ключу. Используется для аутентификации при работе с приватными репозиториями, доступ к которым осуществляется по SSH. Если вы используете HTTPS для приватных репозиториев, это поле можно оставить пустым, но тогда убедитесь, что у вас настроена другая форма аутентификации (например, через токен в URL, если это поддерживается).
*   **`temp_dir`**: Временная директория, в которую сервис будет клонировать репозитории для выполнения операций синхронизации. После завершения синхронизации эта директория будет очищена.
*   **`repositories`**: Массив объектов `RepositoryPair`. Каждый объект определяет одну пару репозиториев для синхронизации:
    *   **`gitlab_url`**: URL репозитория GitLab.
    *   **`private_repo_url`**: URL приватного репозитория. Это может быть репозиторий на GitHub, Bitbucket, Gitea или любом другом Git-хостинге.

## Сборка проекта

Для сборки исполняемого файла `git-sync-service` вам потребуется установленный Go (версии 1.22 или выше).

Откройте терминал в корневой директории проекта и выполните следующую команду:

```bash
go build -o git-sync-service cmd/git-sync-service/main.go
```

Эта команда создаст исполняемый файл с именем `git-sync-service` в текущей директории.

## Запуск сервиса

После сборки вы можете запустить сервис, выполнив исполняемый файл. По умолчанию сервис ожидает файл конфигурации по пути `configs/config.yaml` относительно места запуска.

```bash
./git-sync-service
```

**Примечание:** В текущей реализации путь к файлу конфигурации жестко задан в коде. Если вы хотите использовать разные файлы конфигурации для разных сред (например, `config_home.yaml` и `config_work.yaml`), вам потребуется изменить код в `cmd/git-sync-service/main.go` для чтения пути к файлу конфигурации из аргументов командной строки или переменной окружения.

## Аутентификация

*   **GitLab**: Используется Personal Access Token, который передается через поле `gitlab_token` в конфигурации. Токен используется с именем пользователя "oauth2".
*   **Приватные репозитории (SSH)**: Используется SSH-ключ, указанный в `ssh_key_path`. Убедитесь, что ваш SSH-ключ имеет правильные разрешения и, при необходимости, добавлен в SSH-агент.
*   **Приватные репозитории (HTTPS)**: Если вы используете HTTPS для приватных репозиториев, вам может потребоваться включить токен в URL (например, `https://oauth2:your_token@github.com/user/repo.git`) или настроить другие методы аутентификации, поддерживаемые вашим Git-хостингом.

## Временные директории

Сервис клонирует репозитории во временную директорию, указанную в `temp_dir` в файле конфигурации. После завершения всех операций синхронизации временные директории автоматически удаляются.